; SPIR-V
; Version: 1.0
; Generator: Khronos Glslang Reference Front End; 11
; Bound: 235
; Schema: 0
               OpCapability Shader
               OpCapability ImageQuery
          %1 = OpExtInstImport "GLSL.std.450"
               OpMemoryModel Logical GLSL450
               OpEntryPoint Fragment %main "main" %normal_0 %fragPosition %directionalLightSpacePositions %fragColor
               OpExecutionMode %main OriginLowerLeft
               OpSource GLSL 460
               OpName %main "main"
               OpName %ShadowCalculation_vf4_vf3_s21_vf3_ "ShadowCalculation(vf4;vf3;s21;vf3;"
               OpName %lightSpacePos "lightSpacePos"
               OpName %lightDir "lightDir"
               OpName %shadowMap "shadowMap"
               OpName %normal "normal"
               OpName %projectedCoords "projectedCoords"
               OpName %closestDepth "closestDepth"
               OpName %currentDepth "currentDepth"
               OpName %shadowBias "shadowBias"
               OpName %shadow "shadow"
               OpName %texelSize "texelSize"
               OpName %x "x"
               OpName %y "y"
               OpName %pcfDepth "pcfDepth"
               OpName %resultColour "resultColour"
               OpName %i "i"
               OpName %DirectLight "DirectLight"
               OpMemberName %DirectLight 0 "colour"
               OpMemberName %DirectLight 1 "position"
               OpMemberName %DirectLight 2 "direction"
               OpName %UniformBufferObject "UniformBufferObject"
               OpMemberName %UniformBufferObject 0 "u_DirectLights"
               OpMemberName %UniformBufferObject 1 "u_ObjectColour"
               OpMemberName %UniformBufferObject 2 "u_CameraPosition"
               OpMemberName %UniformBufferObject 3 "u_AmbientStrength"
               OpMemberName %UniformBufferObject 4 "u_SpecularStrength"
               OpMemberName %UniformBufferObject 5 "u_Shininess"
               OpMemberName %UniformBufferObject 6 "u_DirectLightsCount"
               OpName %ubo "ubo"
               OpName %lightColour "lightColour"
               OpName %lightDirection "lightDirection"
               OpName %ambient "ambient"
               OpName %diffuse "diffuse"
               OpName %normal_0 "normal"
               OpName %viewDirection "viewDirection"
               OpName %fragPosition "fragPosition"
               OpName %halfwayDirection "halfwayDirection"
               OpName %specular "specular"
               OpName %shadow_0 "shadow"
               OpName %directionalLightSpacePositions "directionalLightSpacePositions"
               OpName %u_DirectShadowMaps "u_DirectShadowMaps"
               OpName %fragColor "fragColor"
               OpDecorate %normal_0 Location 1
               OpDecorate %fragPosition Location 0
               OpDecorate %directionalLightSpacePositions Location 2
               OpDecorate %u_DirectShadowMaps Location 0
               OpDecorate %u_DirectShadowMaps DescriptorSet 0
               OpDecorate %u_DirectShadowMaps Binding 0
               OpDecorate %fragColor Location 0
       %void = OpTypeVoid
          %3 = OpTypeFunction %void
      %float = OpTypeFloat 32
    %v4float = OpTypeVector %float 4
    %v3float = OpTypeVector %float 3
          %9 = OpTypeImage %float 2D 0 0 0 1 Unknown
         %10 = OpTypeSampledImage %9
%_ptr_UniformConstant_10 = OpTypePointer UniformConstant %10
         %12 = OpTypeFunction %float %v4float %v3float %_ptr_UniformConstant_10 %v3float
%_ptr_Function_v3float = OpTypePointer Function %v3float
       %uint = OpTypeInt 32 0
     %uint_3 = OpConstant %uint 3
  %float_0_5 = OpConstant %float 0.5
     %uint_2 = OpConstant %uint 2
%_ptr_Function_float = OpTypePointer Function %float
    %float_1 = OpConstant %float 1
       %bool = OpTypeBool
    %float_0 = OpConstant %float 0
    %v2float = OpTypeVector %float 2
     %uint_0 = OpConstant %uint 0
%float_0_0500000007 = OpConstant %float 0.0500000007
%float_0_00499999989 = OpConstant %float 0.00499999989
%_ptr_Function_v2float = OpTypePointer Function %v2float
        %int = OpTypeInt 32 1
      %int_0 = OpConstant %int 0
      %v2int = OpTypeVector %int 2
%_ptr_Function_int = OpTypePointer Function %int
     %int_n1 = OpConstant %int -1
      %int_1 = OpConstant %int 1
    %float_9 = OpConstant %float 9
        %123 = OpConstantComposite %v3float %float_0 %float_0 %float_0
%DirectLight = OpTypeStruct %v4float %v3float %v3float
    %uint_20 = OpConstant %uint 20
%_arr_DirectLight_uint_20 = OpTypeArray %DirectLight %uint_20
%UniformBufferObject = OpTypeStruct %_arr_DirectLight_uint_20 %v3float %v3float %float %float %float %int
%_ptr_Private_UniformBufferObject = OpTypePointer Private %UniformBufferObject
        %ubo = OpVariable %_ptr_Private_UniformBufferObject Private
      %int_6 = OpConstant %int 6
%_ptr_Private_int = OpTypePointer Private %int
%_ptr_Private_v4float = OpTypePointer Private %v4float
      %int_2 = OpConstant %int 2
%_ptr_Private_v3float = OpTypePointer Private %v3float
      %int_3 = OpConstant %int 3
%_ptr_Private_float = OpTypePointer Private %float
%_ptr_Input_v3float = OpTypePointer Input %v3float
   %normal_0 = OpVariable %_ptr_Input_v3float Input
%fragPosition = OpVariable %_ptr_Input_v3float Input
      %int_4 = OpConstant %int 4
      %int_5 = OpConstant %int 5
%_arr_v4float_uint_20 = OpTypeArray %v4float %uint_20
%_ptr_Input__arr_v4float_uint_20 = OpTypePointer Input %_arr_v4float_uint_20
%directionalLightSpacePositions = OpVariable %_ptr_Input__arr_v4float_uint_20 Input
%_ptr_Input_v4float = OpTypePointer Input %v4float
%_arr_10_uint_20 = OpTypeArray %10 %uint_20
%_ptr_UniformConstant__arr_10_uint_20 = OpTypePointer UniformConstant %_arr_10_uint_20
%u_DirectShadowMaps = OpVariable %_ptr_UniformConstant__arr_10_uint_20 UniformConstant
%_ptr_Output_v4float = OpTypePointer Output %v4float
  %fragColor = OpVariable %_ptr_Output_v4float Output
       %main = OpFunction %void None %3
          %5 = OpLabel
%resultColour = OpVariable %_ptr_Function_v3float Function
          %i = OpVariable %_ptr_Function_int Function
%lightColour = OpVariable %_ptr_Function_v3float Function
%lightDirection = OpVariable %_ptr_Function_v3float Function
    %ambient = OpVariable %_ptr_Function_v3float Function
    %diffuse = OpVariable %_ptr_Function_v3float Function
%viewDirection = OpVariable %_ptr_Function_v3float Function
%halfwayDirection = OpVariable %_ptr_Function_v3float Function
   %specular = OpVariable %_ptr_Function_v3float Function
   %shadow_0 = OpVariable %_ptr_Function_float Function
               OpStore %resultColour %123
               OpStore %i %int_0
               OpBranch %125
        %125 = OpLabel
               OpLoopMerge %127 %128 None
               OpBranch %129
        %129 = OpLabel
        %130 = OpLoad %int %i
        %139 = OpAccessChain %_ptr_Private_int %ubo %int_6
        %140 = OpLoad %int %139
        %141 = OpSLessThan %bool %130 %140
               OpBranchConditional %141 %126 %127
        %126 = OpLabel
        %143 = OpLoad %int %i
        %145 = OpAccessChain %_ptr_Private_v4float %ubo %int_0 %143 %int_0
        %146 = OpLoad %v4float %145
        %147 = OpVectorShuffle %v3float %146 %146 0 1 2
               OpStore %lightColour %147
        %149 = OpLoad %int %i
        %152 = OpAccessChain %_ptr_Private_v3float %ubo %int_0 %149 %int_2
        %153 = OpLoad %v3float %152
               OpStore %lightDirection %153
        %157 = OpAccessChain %_ptr_Private_float %ubo %int_3
        %158 = OpLoad %float %157
        %159 = OpLoad %v3float %lightColour
        %160 = OpVectorTimesScalar %v3float %159 %158
               OpStore %ambient %160
        %164 = OpLoad %v3float %normal_0
        %165 = OpLoad %v3float %lightDirection
        %166 = OpDot %float %164 %165
        %167 = OpExtInst %float %1 FMax %166 %float_0
        %168 = OpLoad %v3float %lightColour
        %169 = OpVectorTimesScalar %v3float %168 %167
               OpStore %diffuse %169
        %171 = OpAccessChain %_ptr_Private_v3float %ubo %int_2
        %172 = OpLoad %v3float %171
        %174 = OpLoad %v3float %fragPosition
        %175 = OpFSub %v3float %172 %174
        %176 = OpExtInst %v3float %1 Normalize %175
               OpStore %viewDirection %176
        %178 = OpLoad %v3float %lightDirection
        %179 = OpLoad %v3float %viewDirection
        %180 = OpFAdd %v3float %178 %179
        %181 = OpExtInst %v3float %1 Normalize %180
               OpStore %halfwayDirection %181
        %184 = OpAccessChain %_ptr_Private_float %ubo %int_4
        %185 = OpLoad %float %184
        %186 = OpLoad %v3float %normal_0
        %187 = OpLoad %v3float %halfwayDirection
        %188 = OpDot %float %186 %187
        %189 = OpExtInst %float %1 FMax %188 %float_0
        %191 = OpAccessChain %_ptr_Private_float %ubo %int_5
        %192 = OpLoad %float %191
        %193 = OpExtInst %float %1 Pow %189 %192
        %194 = OpFMul %float %185 %193
        %195 = OpLoad %v3float %lightColour
        %196 = OpVectorTimesScalar %v3float %195 %194
               OpStore %specular %196
        %201 = OpLoad %int %i
        %203 = OpAccessChain %_ptr_Input_v4float %directionalLightSpacePositions %201
        %204 = OpLoad %v4float %203
        %205 = OpLoad %v3float %lightDirection
        %209 = OpLoad %int %i
        %210 = OpLoad %v3float %normal_0
        %211 = OpAccessChain %_ptr_UniformConstant_10 %u_DirectShadowMaps %209
        %212 = OpFunctionCall %float %ShadowCalculation_vf4_vf3_s21_vf3_ %204 %205 %211 %210
               OpStore %shadow_0 %212
        %213 = OpLoad %v3float %ambient
        %214 = OpLoad %float %shadow_0
        %215 = OpFSub %float %float_1 %214
        %216 = OpLoad %v3float %diffuse
        %217 = OpLoad %v3float %specular
        %218 = OpFAdd %v3float %216 %217
        %219 = OpVectorTimesScalar %v3float %218 %215
        %220 = OpFAdd %v3float %213 %219
        %221 = OpAccessChain %_ptr_Private_v3float %ubo %int_1
        %222 = OpLoad %v3float %221
        %223 = OpFMul %v3float %220 %222
        %224 = OpLoad %v3float %resultColour
        %225 = OpFAdd %v3float %224 %223
               OpStore %resultColour %225
               OpBranch %128
        %128 = OpLabel
        %226 = OpLoad %int %i
        %227 = OpIAdd %int %226 %int_1
               OpStore %i %227
               OpBranch %125
        %127 = OpLabel
        %230 = OpLoad %v3float %resultColour
        %231 = OpCompositeExtract %float %230 0
        %232 = OpCompositeExtract %float %230 1
        %233 = OpCompositeExtract %float %230 2
        %234 = OpCompositeConstruct %v4float %231 %232 %233 %float_1
               OpStore %fragColor %234
               OpReturn
               OpFunctionEnd
%ShadowCalculation_vf4_vf3_s21_vf3_ = OpFunction %float None %12
%lightSpacePos = OpFunctionParameter %v4float
   %lightDir = OpFunctionParameter %v3float
  %shadowMap = OpFunctionParameter %_ptr_UniformConstant_10
     %normal = OpFunctionParameter %v3float
         %18 = OpLabel
%projectedCoords = OpVariable %_ptr_Function_v3float Function
%closestDepth = OpVariable %_ptr_Function_float Function
%currentDepth = OpVariable %_ptr_Function_float Function
 %shadowBias = OpVariable %_ptr_Function_float Function
     %shadow = OpVariable %_ptr_Function_float Function
  %texelSize = OpVariable %_ptr_Function_v2float Function
          %x = OpVariable %_ptr_Function_int Function
          %y = OpVariable %_ptr_Function_int Function
   %pcfDepth = OpVariable %_ptr_Function_float Function
         %21 = OpVectorShuffle %v3float %lightSpacePos %lightSpacePos 0 1 2
         %24 = OpCompositeExtract %float %lightSpacePos 3
         %25 = OpCompositeConstruct %v3float %24 %24 %24
         %26 = OpFDiv %v3float %21 %25
         %28 = OpVectorTimesScalar %v3float %26 %float_0_5
         %29 = OpCompositeConstruct %v3float %float_0_5 %float_0_5 %float_0_5
         %30 = OpFAdd %v3float %28 %29
               OpStore %projectedCoords %30
         %33 = OpAccessChain %_ptr_Function_float %projectedCoords %uint_2
         %34 = OpLoad %float %33
         %37 = OpFOrdGreaterThan %bool %34 %float_1
               OpSelectionMerge %39 None
               OpBranchConditional %37 %38 %39
         %38 = OpLabel
               OpReturnValue %float_0
         %39 = OpLabel
         %43 = OpLoad %10 %shadowMap
         %45 = OpLoad %v3float %projectedCoords
         %46 = OpVectorShuffle %v2float %45 %45 0 1
         %47 = OpImageSampleImplicitLod %v4float %43 %46
         %49 = OpCompositeExtract %float %47 0
               OpStore %closestDepth %49
         %51 = OpAccessChain %_ptr_Function_float %projectedCoords %uint_2
         %52 = OpLoad %float %51
               OpStore %currentDepth %52
         %55 = OpDot %float %normal %lightDir
         %56 = OpFSub %float %float_1 %55
         %57 = OpFMul %float %float_0_0500000007 %56
         %59 = OpExtInst %float %1 FMax %57 %float_0_00499999989
               OpStore %shadowBias %59
               OpStore %shadow %float_0
         %63 = OpLoad %10 %shadowMap
         %66 = OpImage %9 %63
         %68 = OpImageQuerySizeLod %v2int %66 %int_0
         %69 = OpConvertSToF %v2float %68
         %70 = OpCompositeConstruct %v2float %float_1 %float_1
         %71 = OpFDiv %v2float %70 %69
               OpStore %texelSize %71
               OpStore %x %int_n1
               OpBranch %75
         %75 = OpLabel
               OpLoopMerge %77 %78 None
               OpBranch %79
         %79 = OpLabel
         %80 = OpLoad %int %x
         %82 = OpSLessThanEqual %bool %80 %int_1
               OpBranchConditional %82 %76 %77
         %76 = OpLabel
               OpStore %y %int_n1
               OpBranch %84
         %84 = OpLabel
               OpLoopMerge %86 %87 None
               OpBranch %88
         %88 = OpLabel
         %89 = OpLoad %int %y
         %90 = OpSLessThanEqual %bool %89 %int_1
               OpBranchConditional %90 %85 %86
         %85 = OpLabel
         %92 = OpLoad %10 %shadowMap
         %93 = OpLoad %v3float %projectedCoords
         %94 = OpVectorShuffle %v2float %93 %93 0 1
         %95 = OpLoad %int %x
         %96 = OpConvertSToF %float %95
         %97 = OpLoad %int %y
         %98 = OpConvertSToF %float %97
         %99 = OpCompositeConstruct %v2float %96 %98
        %100 = OpLoad %v2float %texelSize
        %101 = OpFMul %v2float %99 %100
        %102 = OpFAdd %v2float %94 %101
        %103 = OpImageSampleImplicitLod %v4float %92 %102
        %104 = OpCompositeExtract %float %103 0
               OpStore %pcfDepth %104
        %105 = OpLoad %float %currentDepth
        %106 = OpLoad %float %shadowBias
        %107 = OpFSub %float %105 %106
        %108 = OpLoad %float %pcfDepth
        %109 = OpFOrdGreaterThan %bool %107 %108
        %110 = OpSelect %float %109 %float_1 %float_0
        %111 = OpLoad %float %shadow
        %112 = OpFAdd %float %111 %110
               OpStore %shadow %112
               OpBranch %87
         %87 = OpLabel
        %113 = OpLoad %int %y
        %114 = OpIAdd %int %113 %int_1
               OpStore %y %114
               OpBranch %84
         %86 = OpLabel
               OpBranch %78
         %78 = OpLabel
        %115 = OpLoad %int %x
        %116 = OpIAdd %int %115 %int_1
               OpStore %x %116
               OpBranch %75
         %77 = OpLabel
        %118 = OpLoad %float %shadow
        %119 = OpFDiv %float %118 %float_9
               OpStore %shadow %119
               OpReturnValue %119
               OpFunctionEnd